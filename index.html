<html>
    <head>
        <title>EASY METAR</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.1/xlsx.full.min.js"></script>
        <!-- <script 
                src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js" 
            integrity="sha256-vIL0pZJsOKSz76KKVCyLxzkOT00vXs+Qz4fYRVMoDhw="
            crossorigin="anonymous">
	    </script> -->
    </head>
    <body>
        <div ng-app="myApp" ng-controller="formCtrl">
        <div class="container">
            <h2>Easy Metar</h2>
            <form>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="AJ">Aashay</label>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="PKG">Pradeep</label>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="VC">Vivek</label>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="AY">Amitesh</label>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="BKC">BK Chindhalore</label>
                    <label class="radio-inline"><input type="radio" ng-model="initials" value="SPG">S P Gupta</label>
                <br>
                    <div class="form-group">
                    <label for="wd">WindDirection:</label>
                    <input type="text" class="form-control" ng-model="wd">
                </div>
                <div class="form-group">
                        <label for="ws">WindSpeed:</label>
                        <input type="text" class="form-control" ng-model="ws">
                </div>
                <div class="form-group">
                        <label for="vis">Visibility:</label>
                        <input type="text" class="form-control" ng-model="vis">
                </div>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="HZ" checked="">HAZE</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="BR" checked="">MIST</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="FG">FOG</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="DZ">Drizzle</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="RA">Rain</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="TS">Thunderstorm</label>
                <label class="radio-inline"><input type="radio" ng-model="wx" value="TSRA">Thunderstorm & Rain</label>
                    <label class="radio-inline"><input type="radio" ng-model="wx" value="" checked="">Nothing / Clear Wx</label><BR>
                <br>
                <div class="form-group" style="display: inline;">
                        <label for="vis">Clouds 1:</label>
                        <select ng-model="cloud1" ng-options="x for x in clouds">
                        </select>&nbsp;&nbsp;&nbsp;
                        <label for="vis">Clouds 1 Height:</label>
                        <select ng-model="c1Height" ng-options="x for x in c1heights">
                        </select><br>
                        <label for="vis">Clouds 2:</label>
                        <select ng-model="cloud2" ng-options="x for x in clouds">
                        </select>&nbsp;&nbsp;&nbsp;
                        <label for="vis">Clouds 2 Height:</label>
                        <select ng-model="c2Height" ng-options="x for x in c2heights">
                        </select>
                </div>
             
                
                <div class="form-group">
                    <label for="db">DryBulb:</label>
                    <input type="text" class="form-control" ng-model="db">
                  </div>
                  <div class="form-group">
                    <label for="wb">WetBulb:</label>
                    <input type="text" class="form-control" ng-model="wb">
                  </div>
                  <div class="form-group">
                    <label for="pressure">Pressure:</label>
                    <input type="text" class="form-control" ng-model="pressure">
                  </div>
              <button type="submit" class="btn btn-default" ng-click="generate()">Generate Metar</button>
              &nbsp;&nbsp;&nbsp;
              <button type="submit" class="btn btn-default" ng-click="generatePDF()">Generate MET REPORT</button>
              <!-- &nbsp;&nbsp;&nbsp; 
              <button type="submit" class="btn btn-default" ng-click="sendToOlbs()">Send Olbs</button> -->
            </form>
          </div>
          <div ng-show="showMetar">
              <!-- Need to write a answer here  -->
              <h3>{{stuff}}</h3>
              <hr>
              <h3>{{prefixMetar}}</h3>
              <h3>{{metar}}</h3>

          </div>
        </div> 
          <script>
            var app = angular.module('myApp', []);
            app.controller('formCtrl', function($scope,$http) {
                $scope.qfe_qnh_map = {"940" :	["1005.2",	"1005.3",	"1005.4",	"1005.6",	"1005.7",	"1005.8",	"1005.9",	"1006.0",	"1006.1",	"1006.2"],
                                    "941" :	["1006.3",	"1006.4",	"1006.5",	"1006.6",	"1006.7",	"1006.8",	"1006.9",	"1007.0",	"1007.1",	"1007.2"],
                                    "942" :	["1007.3",	"1007.4",	"1007.5",	"1007.6",	"1007.7",	"1007.8",	"1008.0",	"1008.1",	"1008.2",	"1008.3"],
                                    "943" :	["1008.4",	"1008.5",	"1008.6",	"1008.7",	"1008.8",	"1008.9",	"1009.0",	"1009.1",	"1009.2",	"1009.3"],
                                    "944" :	["1009.4",	"1009.6",	"1009.7",	"1009.8",	"1009.9",	"1010.0",	"1010.1",	"1010.2",	"1010.3",	"1010.4"],
                                    "945" :	["1010.5",	"1010.6",	"1010.7",	"1010.8",	"1010.9",	"1011.0",	"1011.1",	"1011.2",	"1011.3",	"1011.4"],
                                    "946" :	["1011.6",	"1011.7",	"1011.8",	"1011.9",	"1012.0",	"1012.1",	"1012.2",	"1012.3",	"1012.4",	"1012.5"],
                                    "947" :	["1012.6",	"1012.7",	"1012.8",	"1012.9",	"1013.0",	"1013.1",	"1013.2",	"1013.3",	"1013.4",	"1013.5"],
                                    "948" :	["1013.6",	"1013.7",	"1013.9",	"1014.0",	"1014.1",	"1014.2",	"1014.3",	"1014.4",	"1014.5",	"1014.6"],
                                    "949" :	["1014.7",	"1014.8",	"1014.9",	"1015.0",	"1015.1",	"1015.2",	"1015.3",	"1015.4",	"1015.5",	"1015.7"],
                                    "950" :	["1015.8",	"1015.9",	"1016.0",	"1016.1",	"1016.2",	"1016.3",	"1016.4",	"1016.5",	"1016.6",	"1016.7"],
                                    "951" :	["1016.8",	"1016.9",	"1017.0",	"1017.1",	"1017.2",	"1017.3",	"1017.4",	"1017.5",	"1017.6",	"1017.7"],
                                    "952" :	["1017.9",	"1018.0",	"1018.1",	"1018.2",	"1018.3",	"1018.4",	"1018.5",	"1018.6",	"1018.7",	"1018.8"],
                                    "953" :	["1018.9",	"1019.0",	"1019.1",	"1019.3",	"1019.4",	"1019.5",	"1019.6",	"1019.7",	"1019.8",	"1019.9"],
                                    "954" :	["1020.0",	"1020.1",	"1020.2",	"1020.3",	"1020.4",	"1020.5",	"1020.6",	"1020.7",	"1020.8",	"1020.9"],
                                    "955" :	["1021.0",	"1021.1",	"1021.2",	"1021.3",	"1021.4",	"1021.5",	"1021.6",	"1021.7",	"1021.9",	"1022.0"],
                                    "956" :	["1022.1",	"1022.2",	"1022.3",	"1022.4",	"1022.5",	"1022.6",	"1022.7",	"1022.8",	"1022.9",	"1023.0"],
                                    "957" :	["1023.1",	"1023.2",	"1023.3",	"1023.4",	"1023.5",	"1023.6",	"1023.7",	"1023.8",	"1024.0",	"1024.1"],
                                    "958" :	["1024.2",	"1024.3",	"1024.4",	"1024.5",	"1024.6",	"1024.7",	"1024.8",	"1024.9",	"1025.0",	"1025.2"],
                                    "960" :	["1026.3",	"1026.4",	"1026.5",	"1026.6",	"1026.7",	"1026.8",	"1026.9",	"1026.9",	"1027.0",	"1027.1"],
                                    "959" :	["1025.3",	"1025.4",	"1025.5",	"1025.6",	"1025.7",	"1025.8",	"1025.9",	"1026.0",	"1026.1",	"1026.2"]}

                $scope.qfe_qnh_inches_map = {
                                        "950": {"0":["2805","1015.8","3000"],
                                                "1":["2805","1015.9","3000"],
                                                "2":["2806","1016.0","3000"],
                                                "3":["2806","1016.1","3001"],
                                                "4":["2806","1016.2","3001"],
                                                "5":["2807","1016.3","3001"],
                                                "6":["2807","1016.4","3001"],
                                                "7":["2807","1016.5","3002"],
                                                "8":["2807","1016.6","3002"],
                                                "9":["2808","1016.7","3002"]},
                                                
                                        "946": {"0":["2794","1011.6","2987"],
                                                "1":["2794","1011.7","2988"],
                                                "2":["2795","1011.8","2988"],
                                                "3":["2795","1011.9","2988"],
                                                "4":["2795","1012.0","2988"],
                                                "5":["2796","1012.1","2989"],
                                                "6":["2796","1012.2","2989"],
                                                "7":["2796","1012.3","2989"],
                                                "8":["2796","1012.4","2990"],
                                                "9":["2796","1012.5","2990"]},

                                         "947": {"0":["2797","1012.6","2990"],
                                                "1":["2797","1012.7","2991"],
                                                "2":["2798","1012.8","2991"],
                                                "3":["2798","1012.9","2991"],
                                                "4":["2799","1013.0","2991"],
                                                "5":["2799","1013.1","2992"],
                                                "6":["2799","1013.2","2992"],
                                                "7":["2799","1013.3","2992"],
                                                "8":["2799","1013.4","2993"],
                                                "9":["2799","1013.5","2993"]},        

                                        "948": {"0":["2799","1013.6","2993"],
                                                "1":["2799","1013.7","2993"],
                                                "2":["2800","1013.9","2994"],
                                                "3":["2800","1014.0","2994"],
                                                "4":["2800","1014.1","2995"],
                                                "5":["2801","1014.2","2995"],
                                                "6":["2801","1014.3","2995"],
                                                "7":["2801","1014.4","2995"],
                                                "8":["2801","1014.5","2996"],
                                                "9":["2802","1014.6","2996"]},

                                        "949": {"0":["2802","1014.7","2996"],
                                                "1":["2802","1014.8","2997"],
                                                "2":["2803","1014.9","2997"],
                                                "3":["2803","1015.0","2997"],
                                                "4":["2803","1015.1","2998"],
                                                "5":["2804","1015.2","2998"],
                                                "6":["2804","1015.3","2998"],
                                                "7":["2804","1015.4","2999"],
                                                "8":["2804","1015.5","2999"],
                                                "9":["2805","1015.7","2999"]},
                                                
                                        "951": {"0":["2808","1016.8","3003"],
                                                "1":["2808","1016.9","3003"],
                                                "2":["2809","1017.0","3003"],
                                                "3":["2809","1017.1","3003"],
                                                "4":["2809","1017.2","3004"],
                                                "5":["2810","1017.3","3004"],
                                                "6":["2810","1017.4","3004"],
                                                "7":["2810","1017.5","3005"],
                                                "8":["2810","1017.6","3005"],
                                                "9":["2811","1017.7","3005"]},

                                        "952": {"0":["2811","1017.9","3006"],
                                                "1":["2811","1018.0","3006"],
                                                "2":["2812","1018.1","3006"],
                                                "3":["2812","1018.2","3007"],
                                                "4":["2813","1018.3","3007"],
                                                "5":["2813","1018.4","3007"],
                                                "6":["2813","1018.5","3008"],
                                                "7":["2813","1018.6","3008"],
                                                "8":["2813","1018.7","3008"],
                                                "9":["2814","1018.8","3009"]},

                                        "953": {"0":["2814","1018.9","3009"],
                                                "1":["2814","1019.0","3009"],
                                                "2":["2815","1019.1","3009"],
                                                "3":["2815","1019.3","3010"],
                                                "4":["2815","1019.4","3010"],
                                                "5":["2816","1019.5","3010"],
                                                "6":["2816","1019.6","3011"],
                                                "7":["2816","1019.7","3011"],
                                                "8":["2816","1019.8","3011"],
                                                "9":["2817","1019.9","3012"]},

                                        "954": {"0":["2817","1020.0","3012"],
                                                "1":["2817","1020.1","3012"],
                                                "2":["2818","1020.2","3012"],
                                                "3":["2818","1020.3","3013"],
                                                "4":["2818","1020.4","3013"],
                                                "5":["2819","1019.5","3013"],
                                                "6":["2819","1020.6","3013"],
                                                "7":["2819","1020.7","3013"],
                                                "8":["2819","1020.8","3014"],
                                                "9":["2820","1020.9","3015"]},
                                        
                                        "955": {"0":["2820","1021.0","3015"],
                                                "1":["2820","1021.1","3015"],
                                                "2":["2821","1021.2","3015"],
                                                "3":["2821","1021.3","3016"],
                                                "4":["2821","1021.4","3016"],
                                                "5":["2822","1011.5","3016"],
                                                "6":["2822","1021.6","3017"],
                                                "7":["2822","1021.7","3017"],
                                                "8":["2822","1021.9","3017"],
                                                "9":["2823","1022.0","3018"]}                                       
                                    };

                $scope.showMetar=false;
                $scope.clouds = ['FEW','SCT','BKN','OVC'];
                $scope.c1heights = ['018','020','025','030'];
                $scope.c2heights = ['025','030','080','090','100','250'];
                $scope.generate = function() {
                    var date = new Date();
                    metarDate = date.getUTCDate()
                    //console.log(date.getUTCDate());
                    var minutes = date.getUTCMinutes();
                    var hours = date.getUTCHours();
                    //console.log(minutes + "  " + hours);
                    if(minutes > 15 && minutes <= 42){
                        minutes = 30;
                    }else if(minutes <= 14) {
                        minutes = "00";
                    }
                    else {
                        minutes = "00";
                        
                        if(hours == '23'){
                            hours = '00'
                            metarDate += 1
                        }else {
                            hours = hours + 1;
                        }
                         
                    }

                    if(hours < 10 && hours != 23)
                        hours = "0"+hours; 
                    console.log($scope.qfe_qnh_map["950"][9]);
                    pres= $scope.pressure;
                    arr = pres.split(".");
                    $scope.time = hours+ ""+ minutes+"Z";
                  
                    // finding qnh from old method.
                    $scope.qfe = arr[0]
                    $scope.qfe_inches = $scope.qfe_qnh_inches_map[arr[0]][arr[1]][0];
                    $scope.qnh_inches = $scope.qfe_qnh_inches_map[arr[0]][arr[1]][2];
                    qnh = $scope.qfe_qnh_map[arr[0]][arr[1]].split(".")[0];
                    $scope.qnh = qnh
                    console.log("QNH itna aa raha hai " +  qnh)
                    dryBulb = Math.round($scope.db)
                    //td = (243.5 * Math.log())
                    $http({
                        method:'GET',
                        url:'dpmap.xlsx',
                        responseType:'arraybuffer'
                    }).then(function(data) {
                        var wb = XLSX.read(data.data, {type:"array"});
                        sheet = $scope.wb.split(".")[0]
                        var d = XLSX.utils.sheet_to_json(wb.Sheets[sheet]);
                
                        //console.log(d[1])
                        dbArr = $scope.db.split(".")
                        dry = dbArr[0]+dbArr[1]
                        wet = $scope.wb.split(".")[1]/2
                        dewPoint = d[wet][dry]
                        strDP = "" + dewPoint
                        
                        if(strDP.includes(".")){
                            dp = Math.round(dewPoint) 
                            $scope.DEWPOINT = dewPoint *10   
                        }else {
                            dp = Math.round(dewPoint/10)
                            $scope.DEWPOINT = dewPoint;
                        }
                        
                        
                        if(dewPoint < 0) {
                            dp = dp *-1
                            if(dewPoint < 10) {
                                dp = "0"+dp
                            }
                            dp = "M"+dp
                        }else if(dp < 10){
                            dp = "0"+dp
                        }

                        if(dryBulb < 10){
                            dryBulb = "0"+dryBulb
                        }
                        console.log("letss seee kya dp "+ $scope.DEWPOINT) 
                        var cloud = ""
                        if( ($scope.cloud1 !== undefined) && ($scope.c1Height !== undefined) ) {
                            height = $scope.c1Height *100
                            $scope.cloud = $scope.cloud1+$scope.c1Height
                            $scope.metCloud1 =  $scope.cloud1+" " + height + "FT " + "("+ ($scope.c1Height * 30)+" M )"+"$"
                            if( ($scope.cloud2 !== undefined) && ($scope.c2Height !== undefined) ){
                                    $scope.cloud += " "+$scope.cloud2+$scope.c2Height
                                    height = $scope.c2Height *100
                                    $scope.metCloud2 =  $scope.cloud2+" " + height + "FT " + "("+ ($scope.c2Height * 30)+" M )"
                            }
                            
                        }else if( ($scope.cloud2 !== undefined ) && ($scope.c2Height !== undefined) ){
                                    $scope.cloud = $scope.cloud2+$scope.c2Height
                                    height = $scope.c2Height *100
                                    $scope.metCloud2 =  $scope.cloud2+" " + height + "FT " + "("+ ($scope.c2Height * 30)+" M )"+"$"
                            }
                        else{
                            $scope.cloud = "NSC"
                            console.log("else mein")
                        }
                        var weather = ""
                        if($scope.wx !== undefined){
                            weather = $scope.wx
                        }
                        if(metarDate < 10){
                            metarDate = "0"+metarDate
                        }
                        db =  parseFloat($scope.db)
                        wb =  parseFloat($scope.wb)
                        ew = 6.112 * Math.exp((17.502 * wb)/(240.97+wb))
                        ed = 6.112 * Math.exp((17.502 * db)/(240.97+db))
                        A = 0.00066 * (1 + 0.00115 * wb ) 
                        humidity = (ew - (A * 900 * (db-wb)))/ed
                        console.log(db +" " +wb+" "+ humidity)
                        humidity = Math.round(humidity * 100)
                        $scope.stuff = "DP = "+ dewPoint + "   QFE & QNH =  "+$scope.qfe_inches + " "+$scope.qfe_qnh_map[arr[0]][arr[1]] +"  "+ $scope.qnh_inches + "  Humidity :: "+ humidity
                        $scope.prefixMetar = "SAIN90 VAID "+metarDate+hours+ minutes;
                        $scope.metar = "METAR VAID " + metarDate+hours+ minutes + "Z " 
                                    +$scope.wd+$scope.ws+"KT " + $scope.vis+ " "+weather+ " "+  $scope.cloud
                                    +" " + dryBulb +"/"+dp+ " Q" + qnh + " NOSIG=";
                                    
                        $scope.showMetar = true;
                        
                    }, function(err) { console.log(err); });

                    // PDF generation....
                    // NEED TO CHECK LATER...
                    //var doc = new jsPDF();
                    //doc.text('Hello world!', 10, 10);
                    //var image = 'data:image/jpeg;base64,SIGNATURE.jpeg'
                    //doc.addImage(image, 'JPEG', 15, 40, 180, 180);
                    //doc.save('a4.pdf');
                    
                }

                $scope.generatePDF = function() {
                    if($scope.showMetar === true){
                        // var doc = new jsPDF();
                        // doc.text('MET REPORT VAID  '+ $scope.time , 10, 10);
                        // doc.text('VIS  '+ $scope.vis , 10, 30);
                        // doc.text('T '+ $scope.db + '   DP  ' + $scope.DEWPOINT , 10, 50);
                        // doc.text('QNH 1015 HPA  3002 INS  ' , 10, 70);
                        // doc.text('QFE 950 HPA  2889 INS  ' , 10, 90);
                        //doc.save('a4.pdf');
                        //console.log(doc)
                        var html = "<!DOCTYPE HTML>";
                        html += '<html lang="en-us">';
                        html += '<head><style></style></head>';
                        html += "<body><font size='4'>";
                        var clouds = "NSC"
                        var weather = ""
                        if($scope.wx !== undefined){
                            weather = $scope.wx
                        }

                        if($scope.metCloud1 !== undefined) {
                            clouds = $scope.metCloud1+" "
                        }
                        if($scope.metCloud2 !== undefined) {
                            if($scope.metCloud1 !== undefined)
                                clouds +=  $scope.metCloud2
                            else    
                                clouds  =  $scope.metCloud2 + " "
                        }
                        console.log("clouds :: "+clouds)
                        var time = new Date()
                        var date = time.getUTCDate()+ "-"+(time.getUTCMonth()+1)+"-"+time.getUTCFullYear()
                        wind = ""
                        if(($scope.wd+$scope.wd) == '00000') {
                            wind = "CALM"
                        }else {
                            wind = $scope.wd+" / "+$scope.ws+"KT " 

                        }

                        // write content here
                        if(clouds !== 'NSC'){
                            html += "<br>MET REPORT VAID  "+ date+"  "+ $scope.time +"&nbsp;&nbsp;&nbsp;&nbsp; WIND &nbsp;&nbsp;"+  wind    +"<br>"+
                                    "<p>VIS " + $scope.vis +" M " +"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+weather + " "+
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLOUDS &nbsp;&nbsp;"+ clouds.split("$")[0] +"<br>"+ 
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+ clouds.split("$")[1] +"<br>"+
                                    "T  " + Math.round($scope.db) +"&nbsp;&nbsp;&nbsp;&nbsp;   DP &nbsp;&nbsp; " + Math.round($scope.DEWPOINT/10) +"</p>"+
                                    "QNH &nbsp;&nbsp;  "+$scope.qnh+" HPA &nbsp;&nbsp;  "+$scope.qnh_inches+"  INS <br>" + 
                                    "QFE &nbsp;&nbsp;&nbsp;  0"+$scope.qfe+"  HPA &nbsp;&nbsp;  "+$scope.qfe_inches+"  INS"+
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+$scope.initials
                        }else {
                            html += "<br>MET REPORT VAID  "+  date +"  "+$scope.time +"&nbsp;&nbsp;&nbsp;&nbsp; WIND &nbsp;&nbsp;"+  wind  +"<br>"+
                                    "<p>VIS " + $scope.vis +" M " +"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+weather + " "+
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLOUDS &nbsp;&nbsp;"+ clouds +"<br><br>"+
                                    "T  " + Math.round($scope.db) +"&nbsp;&nbsp;&nbsp;&nbsp;   DP &nbsp;&nbsp; " + Math.round($scope.DEWPOINT/10) +"</p>"+
                                    "QNH &nbsp;&nbsp;  "+$scope.qnh+" HPA &nbsp;&nbsp;  "+$scope.qnh_inches+"  INS <br>" + 
                                    "QFE &nbsp;&nbsp;&nbsp;  0"+$scope.qfe+"  HPA &nbsp;&nbsp;  "+$scope.qfe_inches+"  INS"+
                                    "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+$scope.initials
                        }
                           
                            html += "</font></body>";
                        var w = window.open();
                        w.document.write(html);
                        w.window.print();
                        w.document.close();
                    }
                }

                $scope.sendToOlbs = function(){
                    var metar = {"A1": "ZCZC+038%0D%0ASAIN90+VAID+110000%0D%0AMETAR+VAID+110000Z+10004KT+3000+HZ+HZ+19%2F17+Q1015+NOSIG%3D%0D%0A",
                                "OFCR": "AMSS",
                                "Submit": "Submit"}
                    $http({
                        method:'POST',
                        data:metar,
                        url:'http://amssdelhi.gov.in/sendata/Action_send1.php',
                       // responseType:'arraybuffer'
                    }).then(function(data) {
                        console.log("success aaya")
                        console.log(data)
                    }, function(err) { console.log(err); });            

                }
            });
            </script>
    </body>
</html>